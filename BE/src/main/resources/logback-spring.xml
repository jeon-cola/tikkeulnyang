<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!-- 기본 콘솔 로그 appender -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Logstash TCP Appender: Logstash의 TCP 입력(port 5000 등)으로 전송 -->
    <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <!-- destination은 Logstash 서버의 호스트:포트입니다. -->
        <destination>logstash:5000</destination>
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <message/>
                <logLevel/>
                <threadName/>
                <loggerName/>
                <mdc/>
                <contextName/>
                <stackTrace/>
            </providers>
        </encoder>
    </appender>

    <!-- SECURITY_MONITOR 전용 File Appender: 보안 로그를 별도 파일에 기록 -->
    <appender name="SECURITY_FILE" class="ch.qos.logback.core.FileAppender">
        <file>/var/log/security.log</file>
        <append>true</append>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- 루트 로거: 전체 일반 로그는 CONSOLE과 LOGSTASH로 출력 -->
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="LOGSTASH"/>
    </root>

    <!-- com.c107 패키지는 DEBUG 레벨로 출력 -->
    <logger name="com.c107" level="DEBUG"/>

    <!-- SECURITY_MONITOR 로거: 보안 이벤트를 JSON 형태로 기록하고, 별도 파일과 LOGSTASH로 전송 -->
    <logger name="SECURITY_MONITOR" level="INFO" additivity="false">
        <appender-ref ref="SECURITY_FILE"/>
        <appender-ref ref="LOGSTASH"/>
        <appender-ref ref="CONSOLE"/>
    </logger>
</configuration>
